<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Users</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  {% load static %}
  <link rel="stylesheet" href="{% static 'user/css/bootstrap.css' %}">
  <link rel="stylesheet" href="{% static 'user/css/style.css' %}">
  <script src="{% static 'user/js/jquery.js' %}"></script>
  <script src="{% static 'user/js/bootstrap.js' %}"></script>
  <script>
    $(document).ready(function(){
      $('#form').submit(function(e){
        e.preventDefault()
      })
      $('#search').keyup(function(){
        $.ajax({
          url: '/users/getuser', /* Where should this go? */
          method: 'post', /* Which HTTP verb? */
          data: $(this).parent().parent().serialize(), /* Any data to send along? */
          success: function(serverResponse) { /* What code should we run when the server responds? */
            $('tbody').html("")
            $('tbody').html(serverResponse)

          }
        })
      });
    });
  </script>
</head>
<body>
    <div id="top" >
        <h1>CodingDojo Wall</h1>
        <a href="/" >
          <button class="btn btn-default commentbutton" style="margin: 20px">Home</button>
        </a>
        <a href="/users/dashboard" >
          <button class="btn btn-default" style="margin: 20px">Dashboard</button>
        </a>
        <a href="/books" >
          <button class="btn btn-default yellowbutton" style="margin: 20px">Books</button>
      </a>
        <div id="userdetail">
            <h3>Welcome, {{request.session.fname}}!</h3>
            <a href="/users/{{request.session.id}}">
                <button type="submit" class="btn btn-default yellowbutton" style="margin: 20px">My Profile</button>
            </a>
            <a href="/logout">
                <button class="btn btn-default" style="margin: 20px">Log Out</button>
            </a>
        </div>
    </div>
    <div id="topback"></div>
  <div id="usertable">
    <form action="/users/getuser" id="form1" style="margin-top: 20px;" method="POST">
      {% csrf_token %}
      <div class="form-group">
        <label for="search">Find Users</label>
        <input type="text" name="search" id="search">
      </div>
    </form>
    <table class="table">
      <thead>
        <tr>
          {%if current.user_level > 0 %}
          <th>id</th>
          {%endif%}
          <th>First Name:</th>
          <th>Last Name:</th>
          <th>Email:</th>
          <th>Actions:</th>
        </tr>
      </thead>
      <tbody>
      {%for i in users%}
      <tr>
        {%if current.user_level > 0 %}
        <td>{{i.id}}</td>
        {%endif%}
        <td>{{i.first_name}}</td>
        <td>{{i.last_name}}</td>
        <td>{{i.email}}</td>
        <td>
          <div class="buttons2">
            <a href="/users/{{i.id}}">Show</a>
            {%if current.user_level > 0 %}
            <a href="/users/{{i.id}}/edit">Edit</a>
            <a href="/users/{{i.id}}/delete">Delete</a>
            {%endif%}
          </div>  
        </td>
      </tr>
      {%endfor%}
      </tbody>
    </table>
    {% if current.user_level > 0 %}
    <div class="buttons">
      <a href="/users/create"><button class="btn btn-default" style="margin: 20px">Create User</button></a>
    </div>
    {%endif%}
  </div>
</body>
</html>